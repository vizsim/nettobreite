<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <title>Nettobreite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="expand-horizontal-svgrepo-com.svg" type="image/svg+xml">
  <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.6.0/dist/maplibre-gl.css' />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div id="map"></div>

  <div class="legend">
    <!-- ====================
MAIN HEADER
======================= -->
    <div class="legend-header legend-title" data-toggle="legend-root" style="position: relative;">
      <div style="flex-grow: 1;">
        <div class="legend-heading">
          <span>Nettobreite</span>
          <img src="expand-horizontal-svgrepo-com.svg" alt="width">
        </div>
        <div class="legend-subtext">
          Straßennettobreite-Darstellung auf Basis von OSM-Daten<span class="info-icon" title="Quelle: OpenStreetMap Contributors – Datenstand: 5.11.2025">ⓘ</span> <br>
          und der Berechnung von 
          <a href="https://www.osm-verkehrswende.org/cqi/" target="_blank" rel="noopener noreferrer">Cycling Quality Index</a>
          
        </div>
      </div>
      <div style="position: absolute; top: 0; right: 0; display: flex; align-items: center;">
        <img src="https://img.shields.io/badge/Status-Experimental-red" alt="Status: Experimental"
          style="height: 18px; width: auto; display: block;">
      </div>
      <span class="toggle-arrow toggle-root open" data-arrow="legend-root"></span>
    </div>

    <div class="legend-section-divider"></div>


        <!-- ====================
     Sektion: Definition
======================= -->
<div class="legend-section collapsed" data-section="definition" style="display: block;">
  <div class="legend-section-title section-toggle" data-section-id="definition"
    style="display: flex; align-items: center; justify-content: space-between;">
    <span>Definition</span>
    <span class="toggle-arrow section-arrow" data-arrow="definition"></span>
  </div>
  <div class="legend-section-content">
    <div style="margin-top: 6px; margin-left: 10px; font-size: 12px; line-height: 1.6;">
      <p style="margin: 0 0 8px 0;">
        Im Grunde gibt es zwei übergeordnete Arten von Breitenangaben an highways:
      </p>
      <p style="margin: 0 0 6px 0; font-weight: bold;">
        Breite von Bordstein zu Bordstein:
      </p>
      <ul style="margin: 0 0 12px 20px;">
        <li><code><a href="https://wiki.openstreetmap.org/wiki/Key:width#Width_of_streets" target="_blank" rel="noopener noreferrer">width</a></code></li>
        <li><code><a href="https://wiki.openstreetmap.org/wiki/Key:width:carriageway" target="_blank" rel="noopener noreferrer">width:carriageway</a></code></li>
      </ul>
      <p style="margin: 0 0 6px 0; font-weight: bold;">
        Nettobreite (nutzbare Breite):
      </p>
      <ul style="margin: 0 0 12px 20px;">
        <li><code><a href="https://wiki.openstreetmap.org/wiki/Key:width:effective" target="_blank" rel="noopener noreferrer">width:effective</a></code> – nutzbare Breite abzüglich Parken und Radwege o.ä.</li>
      </ul>
      <div style="margin-top: 12px;">
        <a href="https://wiki.openstreetmap.org/wiki/File:Width_effective_parking.png" target="_blank" rel="noopener noreferrer" title="Quelle: OpenStreetMap Wiki">
          <img src="https://wiki.openstreetmap.org/w/images/c/c0/Width_effective_parking.png" 
               alt="Width effective parking illustration" 
               style="max-width: 80%; height: auto; border: 1px solid #ddd; border-radius: 4px;">
        </a>
        <p style="margin: 4px 0 0 0; font-size: 10px; color: #666;">
          Quelle: <a href="https://wiki.openstreetmap.org/wiki/File:Width_effective_parking.png" target="_blank" rel="noopener noreferrer">OpenStreetMap Wiki</a><br>
          Attribution: <a href="https://www.openstreetmap.org/user/Supaplex030" target="_blank" rel="noopener noreferrer">Supaplex030</a>
        </p>
      </div>
      <div style="margin-top: 16px;">
        <p style="margin: 0 0 6px 0; font-weight: bold; font-size: 13px;">
          Problem:
        </p>
        <p style="margin: 0; font-size: 12px; line-height: 1.6;">
          Häufig ist der Tag <code>width</code> in OSM vergeben, der Mapper meinte aber <code>width:effective</code>, damit wird die berechnete Nettobreite total unterschätzt. Diese Fälle findet man aber hier gut unter "Effektive Breite &lt; 2 m – Wert nicht plausibel" (grau).
        </p>
      </div>
    </div>
  </div>
</div>

<div class="legend-section-divider"></div>


    <!-- ====================
     Sektion: Nettobreite Layer
======================= -->
    <div class="legend-section" data-section="nettobreite">
      <div class="legend-section-title section-toggle" data-section-id="nettobreite"
        style="display: flex; align-items: center; justify-content: space-between;">
        <span title="Errechnete Nettobreite oder falls gegeben 'effective:width' direkt aus OSM">Nettobreite</span>
        <span class="toggle-arrow section-arrow open" data-arrow="nettobreite"></span>
      </div>
      <div class="legend-section-content">
        <div style="margin-top: 6px;">
          <label style="margin-left: 10px;">
            <input type="checkbox" id="toggle-nettobreite" checked />
            Nettobreite anzeigen
          </label>
        </div>
        
        <!-- Farb-Legende -->
        <div style="margin-left: 20px; margin-top: 12px; font-size: 11px;">
          <div style="font-weight: bold; margin-bottom: 8px;">Effektive Breite (in m)</div>
          <div style="margin-top: 8px;">
            <div class="legend-category" data-width-range="not-plausible" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#808080;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">&lt; 2 m – Wert nicht plausibel</span>
            </div>
            <div class="legend-category" data-width-range="very-narrow" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#e51900;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">2 – 3 m – Extrem schmal</span>
            </div>
            <div class="legend-category" data-width-range="narrow-3-4" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#ff5500;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">3 – 4 m – Sehr schmal</span>
            </div>
            <div class="legend-category" data-width-range="narrow-4-45" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#ff8800;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">4 – 4.5 m – Eng</span>
            </div>
            <div class="legend-category" data-width-range="narrow-45-5" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#ffaa00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">4.5 – 5 m – Eng</span>
            </div>
            <div class="legend-category" data-width-range="restricted-5-55" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#e5dd00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">5 – 5.5 m – Eingeschränkt</span>
            </div>
            <div class="legend-category" data-width-range="sufficient-55-6" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#ccff00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">5.5 – 6 m – Ausreichend</span>
            </div>
            <div class="legend-category" data-width-range="wide-6-7" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#99ff00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">6 – 7 m – Breit</span>
            </div>
            <div class="legend-category" data-width-range="very-wide-7-8" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#66ff00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">7 – 8 m – Sehr breit</span>
            </div>
            <div class="legend-category" data-width-range="very-wide-8plus" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#00cc00;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">&gt; 8 m – Sehr breit</span>
            </div>
            <div class="legend-category" style="display: flex; align-items: center; margin-bottom: 4px;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#000000;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text">Fehlende Angaben</span>
            </div>
            <div class="legend-category legend-subcategory" data-width-range="cycleway-missing" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#000000;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text"><code>cycleway</code> nicht angegeben</span>
            </div>
            <div class="legend-category legend-subcategory" data-width-range="parking-missing" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#000000;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text"><code>parking</code> nicht angegeben</span>
            </div>
            <div class="legend-category legend-subcategory" data-width-range="widths-missing" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
              <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#000000;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
              <span class="legend-text"><code>width</code> nicht angegeben</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="legend-section-divider"></div>


    <!-- ====================
     Sektion: Breite width / width:carriageway
======================= -->
<div class="legend-section collapsed" data-section="width" style="display: block;">
  <div class="legend-section-title section-toggle" data-section-id="width"
    style="display: flex; align-items: center; justify-content: space-between;">
    <span title="'width' oder 'width:carriageway' direkt aus OSM">Breite</span>
    <span class="toggle-arrow section-arrow" data-arrow="width"></span>
  </div>
  <div class="legend-section-content">
    <div style="margin-top: 6px;">
      <label style="margin-left: 10px;">
        <input type="checkbox" id="toggle-width" />
        Breite anzeigen
      </label>
    </div>
    
    <!-- Farb-Legende -->
    <div style="margin-left: 20px; margin-top: 12px; font-size: 11px;">
      <div style="font-weight: bold; margin-bottom: 8px;">Breite <code>width</code> / <code>width:carriageway</code> (in m)</div>
      <div style="margin-top: 8px;">
        <div class="legend-category" data-width-range="width-1" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#8b2988;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">&lt; 5 m</span>
        </div>
        <div class="legend-category" data-width-range="width-2" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#b73779;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">5 – 7 m</span>
        </div>
        <div class="legend-category" data-width-range="width-3" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#db5c68;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">7 – 9 m</span>
        </div>
        <div class="legend-category" data-width-range="width-4" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#f98c09;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">9 – 11 m</span>
        </div>
        <div class="legend-category" data-width-range="width-5" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#fcce25;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">&gt; 11 m</span>
        </div>
        <div class="legend-category" data-width-range="width-missing" style="display: flex; align-items: center; margin-bottom: 4px; cursor: pointer;">
          <span class="legend-color" style="display:inline-block;width:24px;height:4px;background:#000000;border:1px solid #ccc;margin-right:8px;border-radius:2px;"></span>
          <span class="legend-text">Fehlende Angaben</span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="legend-section-divider"></div>
    <!-- ====================
     Sektion: Helper/Straßenfotos
======================= -->
    <div class="legend-section" data-section="mapillary" style="display: block;">
      <div class="legend-section-title section-toggle" data-section-id="mapillary"
        style="display: flex; align-items: center; justify-content: space-between;">
        <span>Helper/Straßenfotos</span>
        <span class="toggle-arrow section-arrow open" data-arrow="mapillary"></span>
      </div>
      <div class="legend-section-content">

        <div style="margin-top: 6px;">
          <label style="margin-left: 10px;">
            <input type="checkbox" id="toggle-mapillary" />
            Mapillary-Bilder anzeigen
            <span class="info-icon" title="Quelle: Mapillary Coverage – Lizenz: CC BY-SA 4.0">ⓘ</span>
          </label>
        </div>

        <div id="mapillary-filter-options" style="display: none; margin-left: 32px; margin-top: 6px;">
          <label style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px;">
            <input type="checkbox" id="mapillary-nonpano" />
            <span style="width: 12px; height: 12px; background: #00b955; border-radius: 2px;"></span>
            normale Bilder
          </label>
          <label style="display: flex; align-items: center; gap: 6px;">
            <input type="checkbox" id="mapillary-pano" />
            <span style="width: 12px; height: 12px; background: #0077ff; border-radius: 2px;"></span>
            Panorama-Bilder
          </label>
        </div>

      </div>
    </div>

    <div class="legend-section-divider"></div>



    <div id="feature-count-wrapper"
      style="margin-top:10px; display: flex; justify-content: space-between; align-items: center; gap: 12px;">
      <div id="feature-count">
        <div>Zoomlevel: ...</div>
      </div>
      <div style="display: flex; align-items: center; gap: 8px;">
          <a href="https://github.com/vizsim/nettobreite" target="_blank" rel="noopener noreferrer" 
             title="GitHub Repository" 
             style="display: inline-flex; align-items: center; text-decoration: none; color: #24292f;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle;">
              <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
          </a>
          <a href="https://github.com/vizsim/nettobreite/issues" target="_blank" rel="noopener noreferrer" 
             title="Fehler melden oder Feedback geben"
             style="display: inline-flex; align-items: center; text-decoration: none; color: #24292f; font-size: 12px;">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="vertical-align: middle; margin-right: 4px;">
              <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/>
              <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"/>
            </svg>
            Issues
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Gemeinsamer Container -->
  <div id="bottom-left-ui-container">
    <div id="custom-nav-control"></div>

    <div id="basemap-thumbnails">
      <div class="basemap-thumb selected" data-map="standard" title="Standard"></div>
      <div class="basemap-thumb" data-map="satellite" title="Satellit"></div>
    </div>

    <div id="terrain-controls">
      <label><input type="checkbox" id="toggleTerrain" /> Terrain</label>
      <label><input type="checkbox" id="toggleHillshade" /> Hillshade</label>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@5.9.0/dist/maplibre-gl.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/pmtiles@4.3.0/dist/pmtiles.js"></script>
  <script type="module" src="./main.js"></script>
</body>

</html>
